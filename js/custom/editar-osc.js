"use strict";require(["jquery-ui","libs/jquery-mask/jquery.mask.min"],function(e){$(document).tooltip({position:{my:"center bottom-20",at:"center top",using:function(e,a){$(this).css(e),$("<div>").addClass("arrow").addClass(a.vertical).addClass(a.horizontal).appendTo(this)}}}),$(".scroll").click(function(e){e.preventDefault(),$("html,body").animate({scrollTop:$(this.hash).offset().top},800)})}),require(["react","rotas","jsx!components/Util","jsx!components/EditarOSC","jquery","jquery-ui","datatables-responsive","editarCabecalho"],function(e){var a="js/controller.php",o=new DataForms,t=new Util,r=new Rotas,n=new Cabecalho,s=new DadosGerais,c=new AreaAtuacao,l=new Descricao,d=new TitulosCertificacoes,u=new RelacoesGovernanca,p=new EspacosPartSocial,_=new Projeto,h=new FonteRecurso,f=null,m={};require(["componenteFormItem","componenteCabecalho","componenteCheckbox","componenteSection","componenteAgrupador","componenteFormItemButtons","componenteAgrupadorInputProjeto","componenteAgrupadorConferencia","componenteAgrupadorConselhos","componenteTitulosCertificacoes","jquery","select-boxit"],function(v,g,b,j,x,y,O,C,P,k){function A(){$("#btnInserirImg").append('<label class="custom-file-upload btn btn-info" title="Clique para Inserir o Logo da OSC"><input id="inserirLogo" type="file" accept="image/x-png,image/gif,image/jpeg" /><i class="fa fa-cloud-upload"></i>Inserir Logo</label>'),$("#btnRemoverImg").append('<a class="btn btn-danger btn-sm" id="btnRemoverLogo" type="button" title="Clique para Remover o Logo da OSC" ><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Remover Logo</a>')}function S(o,t,i,n){function s(e){var a,o=!1;"-1"==e&&(o=!0);var n=_.carregaProjeto(e,i,r,t,o);"Representante"==(n.projeto?n.projeto.projeto[0].ft_nome_projeto:"")?((m={}).headers=W,m.id_osc=Y,success=t.carregaAjax(r.RemoverProjectByID(e,Y),"POST",m),console.log(success),"Projeto excluído."==success.msg?(a={"Removido com sucesso!":"Suas alterações serão processadas aproximadamente em 1(uma) hora.<br><br>Obrigado!"},t.abrirModalAjuda("Removido com sucesso!",a)):(a={"Problema ao remover projeto!":"Esse projeto possivelmente já foi removido.<br> Suas alterações serão processadas aproximadamente em 1(uma) hora.<br><br>Obrigado!"},t.abrirModalAjuda("Problema ao remover projeto!",a))):"-1"!=e?(a={"Problema ao remover projeto!":"Esse projeto possivelmente é um projeto de dados oficiais e não pode ser removido.<br> Suas alterações serão processadas aproximadamente em 1(uma) hora.<br><br>Obrigado!"},t.abrirModalAjuda("Problema ao remover projeto!",a)):(a={"Novo Projeto!":"Esse projeto possivelmente foi inseriodo agora!"},t.abrirModalAjuda("Erro ao remover projeto!",a))}var c=_.montarProjetos(o,t),l=c[0];j=e.createFactory(j),ReactDOM.render(j({dados:[l]}),document.getElementById("projetos")),$("#lista_projetos").append('<table id="table_lista_projetos" class="table-striped"></table>');var d=c[1],u=w(d);$("#table_lista_projetos tbody td").each(function(e){t.validateObject(d[e])&&"Representante"==_.carregaProjeto(d[e][0],i,r,t,!1).projeto.projeto[0].ft_nome_projeto&&$(this).append('<button id="id_botao-projeto" attr="'+d[e][0]+'" class="btn-danger btn botao-projeto">Remover Projeto</button>')}),$("#table_lista_projetos").append('<span class="input-group-btn"><button id="add_projeto" class="btn-primary btn">Adicionar Projeto</button></span>'),$("#table_lista_projetos tbody td").each(function(){$(this).prepend('<span class="glyphicon glyphicon-book" aria-hidden="true"></span> '),$(this).wrapInner("<div class='titulo-projeto'></div>")});var p=0;$("#add_projeto").click(function(){N(),u.row.add([-1,'<div class="titulo-projeto"><span class="glyphicon glyphicon-book" aria-hidden="true"></span> Novo Projeto']).draw(!1),verificarContraste()}),$("#table_lista_projetos").on("click",".titulo-projeto",function(){var e=$(this).parent().parent().get(0),o=!1,s=u.row(e).data()[0],c=$(this).next(".projeto");if(-1==s&&(o=!0,s=Number(s)-p,p+=1),c.length<1){var l=function(){var e=0;return $(".osc_parceira input").each(function(){e+=1}),e-1},d=_.carregaProjeto(s,i,r,t,o),h=d.agrupadores,f=d.projeto,m=f?f.projeto[0].tx_identificador_projeto_externo:null,v="projeto-"+s;$(this).after('<div id="'+v+'" class="projeto col-md-12">'),T(h,s),R(n),$("#"+v+" #nr_valor_total_projeto input").mask("000.000.000.000.000,00",{reverse:!0}),$("#"+v+" #nr_valor_total_projeto input").addClass("with-pretext"),$("#"+v+" #nr_valor_total_projeto input").before('<span class="pretext">R$</span>'),$("#"+v+" #nr_valor_captado_projeto input").mask("000.000.000.000.000,00",{reverse:!0}),$("#"+v+" #nr_valor_captado_projeto input").addClass("with-pretext"),$("#"+v+" #nr_valor_captado_projeto input").before('<span class="pretext">R$</span>'),$("#"+v+" #nr_total_beneficiarios input").mask("00000000"),$($("#"+v).find("div")[0]).attr("id",m),$(".local button.btn-primary").click(function(){F($("#tx_nome_abrangencia_projeto").find(":selected").text())}),$("#tx_nome_abrangencia_projeto").change(function(){F($(e).find(":selected").text())}),$(".osc_parceira button.btn-primary").click(function(){U(l())}),$("#osc_parceira").find("input").autocomplete({source:function(e,o){var t=$(this)[0].term,i="",n="";G(t)&&$.ajax({url:a,type:"GET",dataType:"json",data:{flag:"autocomplete",rota:r.AutocompleteOSCByCnpj(B(t).replace(/ /g,"+"),10)},success:function(e){null==e?$("#osc_parceira").find("input")[0].value="Entidade não cadastrada!":(i=e[0].tx_nome_osc,n=e[0].id_osc,$("#osc_parceira").find("input")[0].value=i,$("#osc_parceira").find("input")[0].id_osc_parceira=n)},error:function(e){o([])}})}}),f?(E(f.projeto[0],s),D(f.projeto[0],s)):(E({},s),D({},s)),verificarContraste()}else $(this).next(".projeto").toggleClass("hidden")}),$("#table_lista_projetos_paginate").click(function(e){var a=$(".paginate_button.current").text();a=10*(a-1),0==$("#id_botao-projeto").length&&$("#table_lista_projetos tbody td").each(function(e){t.validateObject(d[e+a])&&"Representante"==_.carregaProjeto(d[e+a][0],i,r,t,!1).projeto.projeto[0].ft_nome_projeto&&($(this).append('<button id="id_botao-projeto" attr="'+d[e+a][0]+'" class="btn-danger btn botao-projeto">Remover Projeto</button>'),$(this).prepend('<span class="glyphicon glyphicon-book" aria-hidden="true"></span> ')),0==$(this).find(".glyphicon").length&&$(this).prepend('<span class="glyphicon glyphicon-book" aria-hidden="true"></span> ')}),$(".botao-projeto").click(function(){s($(this).attr("attr"))}),verificarContraste()}),$(".botao-projeto").click(function(){s($(this).attr("attr")),verificarContraste()})}function R(e){var a=e[0],o=e[1];$divAreaAtuacaoProjeto=$(".projeto #area_atuacao input");new AreaAtuacao;var t=0;$divAreaAtuacaoProjeto.addClass("autocomplete"),$divAreaAtuacaoProjeto.append('<div class="checkboxList"></div>');for(var i=0;i<a.length;i++){var r=a[i];$divAreaAtuacaoProjeto.find(".checkboxList").append("<div>");for(var n=0;n<o.length;n++){var s=o[n];r.cd_area_atuacao,s.cd_area_atuacao}}a=$.map(a,function(e){return{label:e.tx_nome_area_atuacao,value:e.tx_nome_area_atuacao,id:e.cd_area_atuacao}}),$(".projeto .autocomplete").autocomplete({minLength:0,create:function(e,o){for(var t=$(this).attr("placeholder"),i=0;i<a.length;i++)if(a[i].value===t){var r=$(this).siblings(".checkboxList").find("#subareas-"+i);r.hasClass("hidden")&&r.toggleClass("hidden");for(var n=0;n<a.length;n++)if(t===a[n].tx_nome_area_atuacao){var s=!1;r.find("label").each(function(){a[n].tx_nome_subarea_atuacao===$(this).text().trim()&&(s=$(this))}),s?s.find("input").prop("checked",!0):r.find("#outros").val(a[n].tx_nome_subarea_atuacao)}}},source:a,change:function(e,a){},select:function(e,o){"macro_area_1"==e.target.id?($("#sub_area_1_outros").parent().parent().addClass("hidden"),$("#sub_area_1_outros").val(""),$(this).parent().find(":checkbox").prop("checked",!1)):($("#sub_area_2_outros").parent().parent().addClass("hidden"),$("#sub_area_2_outros").val(""),$(this).parent().find(":checkbox").prop("checked",!1));var i=e.target,r=a.indexOf(o.item)+1;t=r;var n=$($(i).siblings(".checkboxList")[0]);n.children().each(function(e){$(this).hasClass("hidden")||($(this).toggleClass("hidden"),$(this).children().each(function(e){var a=$($(this).find("input")[0]);a.is(":checked")&&a.prop("checked",!1),"text"==a.prop("type")&&a.val("")}))});var s=n.find("#subareas-"+r);s.hasClass("hidden")&&s.toggleClass("hidden");var c=o.item.value,l=$(this).closest(".form-group"),d=null;if(d="macro_area_1"===(r=l.find(".autocomplete").attr("id"))?l.siblings().find("#macro_area_1_outros").closest(".form-group"):l.siblings().find("#macro_area_2_outros").closest(".form-group"),"Outros"===c)d.toggleClass("hidden"),d.hasClass("hidden")&&(u=d.find("input")).val("");else if(!d.hasClass("hidden")){d.toggleClass("hidden");var u=d.find("input");u.val("")}}}),$(".autocomplete").on("click",function(){$(this).autocomplete("search","")}),$(".autocomplete").keyup(function(){if(""===$(this).val()&&0!=t){var e=t,a=$(this).parent().find("#subareas-"+e);a.hasClass("hidden")||a.toggleClass("hidden")}})}function w(e){return $("#table_lista_projetos").DataTable({responsive:!0,deferLoading:1e3,deferRender:!0,ordering:!1,data:e,columns:[{DT_RowId:"Id"},{title:"Nome do Projeto"}],order:[],aoColumnDefs:[{bSortable:!1,aTargets:[0]},{targets:[0],visible:!1,searchable:!1}],autoWidth:!0,oLanguage:o.oLanguageDataTable()})}function T(a,o){O=e.createFactory(O),ReactDOM.render(O({dados:a}),document.getElementById("projeto-"+o)),$(".date").datepicker({dateFormat:"dd-mm-yy",changeYear:!0}),$(".ano").datepicker({dateFormat:"yy"}),$("#projeto-"+o).on("click",".btn-danger",function(){$(this).parents(".input-group").remove()}),$("#projeto-"+o).find(".btn-primary").bind("click",function(){$(this).parent().siblings(".form-group").append('<div class="input-group"><div><input class="form-control" placeholder="Insira a informação"></input></div><span class="input-group-btn"><button class="btn-danger btn">Remover</button></span></div>')})}function E(e,a){for(var o=e.osc_parceira?e.osc_parceira.length:0,i=0;i<o;i++)t.validateObject(e.osc_parceira[i].id_osc,null)}function D(e,o){var i=t.validateObject(e.objetivo_meta,""),n=t.validateObject(i[0],""),s=t.validateObject(n.tx_nome_objetivo_projeto,-1),c=t.validateObject(n.cd_objetivo_projeto,-1),l=[],d=[];if(-1!==s)for(var u=0;u<i.length;u++){var p=i[u].cd_meta_projeto,_=i[u].tx_nome_objetivo_projeto;l.push(p),d.push(_)}$.ajax({url:a,type:"GET",dataType:"json",data:{flag:"consulta",rota:r.Objetivos()},error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(e){M(e,c),$("#objetivos select").selectBoxIt({theme:"default",autoWidth:!1}),$("#objetivos select").selectBoxIt("refresh")}});var h=$("#projeto-"+o);h.append('<div class="col-md-12" id="objetivos-metas"</div>'),$divObjetivosMetasProjeto=h.find("#objetivos-metas"),$divObjetivosMetasProjeto.append('<div id="objetivos" class="objetivos"></div>'),$divObjetivosProjeto=$divObjetivosMetasProjeto.find("#objetivos"),$divObjetivosProjeto.append('<div class="header" title="Indique se o PAP se relaciona com alguns dos objetivos do desenvolvimento sustentável, da ONU.">Objetivos do Desenvolvimento Sustentável - ODS - <a href="http://www.agenda2030.com.br/" target=_blank><img class="imgLinkExterno" src="img/site-ext.gif" width="17" height="11" alt="Site Externo." title="Site Externo." /></a> </div>'),$divObjetivosProjeto.append('<div class="form-group"><div id="objetivos"><select class="form-control"></select></div></div>'),$divObjetivosMetasProjeto.append('<div id="metas-'+o+'" class="metas"></div>'),(J=$divObjetivosMetasProjeto.find("#metas-"+o)).append('<br><div class="header" title="Marque as metas que se enquadram neste projeto">Metas Relacionadas ao ODS definido</div><br>'),J.append('<ol id="selectable-'+c+'" class="selectable"></ol><br>'),c&&I(c,l),z()}function M(e,a){var o=e,t=$divObjetivosProjeto.find("select");-1==a?t.append('<option value=-1 selected id="0">Selecione uma opção...</option>'):t.append('<option value=-1 id="0">Selecione uma opção...</option>');for(var i=0;i<o.length;i++)o[i].cd_objetivo_projeto===a?t.append('<option selected id="'+o[i].cd_objetivo_projeto+'">'+o[i].tx_nome_objetivo_projeto+"</option>"):t.append('<option id="'+o[i].cd_objetivo_projeto+'">'+o[i].tx_nome_objetivo_projeto+"</option>")}function I(e,o){$.ajax({url:a,type:"GET",dataType:"json",data:{flag:"consulta",rota:r.MetaProjeto(e)},error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(a){L(a,e,o)}})}function z(){$(".objetivos").find("select").on("change",function(){cd_objetivo=$(this).children(":selected").attr("id"),$divObjetivosMetasProjeto=$(this).parents("#objetivos-metas"),$divObjetivosMetasProjeto.find(".metas").each(function(){$(this).hasClass("hidden")||$(this).toggleClass("hidden")}),$divObjetivosMetasProjeto.find(".metas").remove(),$divObjetivosMetasProjeto.append('<div id="metas-'+cd_objetivo+'" class="metas"></div>'),$("#metas-"+cd_objetivo).append('<br><div class="header" title="Marque as metas que se enquadram neste projeto">Metas Relacionadas ao ODS definido</div><br>'),$("#metas-"+cd_objetivo).append('<ol id="selectable-'+cd_objetivo+'" class="selectable"></ol><br>'),$("#metas-"+cd_objetivo).hasClass("hidden")&&$("#metas-"+cd_objetivo).toggleClass("hidden"),0!==parseInt(cd_objetivo)&&I(cd_objetivo,[]),verificarContraste()})}function L(a,o,i){if(t.validateObject(a,!1)){var r=function(e,a,o,t,i){this.id=e,this.label=a,this.value=o,this.type=t,this.checked=i},n=[];items=a;for(var s=0;s<items.length;s++){var c=null;i.includes(items[s].cd_meta_projeto)?(c=new r(items[s].cd_meta_projeto,items[s].tx_nome_meta_projeto,items[s].tx_nome_meta_projeto,"checkbox",!0),n.push(c)):(c=new r(items[s].cd_meta_projeto,items[s].tx_nome_meta_projeto,items[s].tx_nome_meta_projeto,"checkbox",!1),n.push(c))}b=e.createFactory(b),ReactDOM.render(b({dados:n}),document.getElementById("selectable-"+o))}}function q(){var e=o.jsonModalAjuda();$(".ajuda").on("click",function(){t.abrirModalAjuda($(this).attr("data"),e)})}function B(e){return e=e.replace(/[ÀÁÂÃÄÅ]/g,"A"),e=e.replace(/[àáâãäå]/g,"a"),e=e.replace(/[ÉÈÊË]/g,"E"),e=e.replace(/[éèêë]/g,"e"),e=e.replace(/[ÍÌÎÏ]/g,"I"),e=e.replace(/[íìîï]/g,"i"),e=e.replace(/[ÓÒÔÕ]/g,"O"),e=e.replace(/[óòôõ]/g,"o"),e=e.replace(/[ÚÙÛÜ]/g,"U"),e=e.replace(/[úùûü]/g,"u"),e=e.replace(/[Ç]/g,"C"),e=e.replace(/[ç]/g,"c")}function F(e){var o="",t=e.toLowerCase();$("#localizacao_projeto .form-control").autocomplete({minLength:3,source:function(e,i){"estadual"==t||"municipal"==t?o=r.AutocompleteOSCByCounty(B(e.term).replace(/ /g,"+"),25):"regional"!=t&&"nacional"!=t||(o=r.AutocompleteOSCByState(B(e.term).replace(/ /g,"+"),10)),""!=o&&$.ajax({url:a,type:"GET",dataType:"json",data:{flag:"autocomplete",rota:o},success:function(e){i($.map(e,function(e){return"estadual"==t||"municipal"==t?{label:e.edmu_nm_municipio+" - "+e.eduf_sg_uf,value:e.edmu_nm_municipio+" - "+e.eduf_sg_uf,id:e.edmu_cd_municipio}:"regional"==t||"nacional"==t?{label:e.eduf_nm_uf,value:e.eduf_nm_uf,id:e.eduf_cd_uf}:void 0}))},error:function(e){i([])}})}})}function G(e){if(""==(e=e.toString().replace(/[^\d]+/g,""))||14!=e.length)return!1;for(tamanho=e.length-2,numeros=e.substring(0,tamanho),digitos=e.substring(tamanho),soma=0,pos=tamanho-7,i=tamanho;i>=1;i--)soma+=numeros.charAt(tamanho-i)*pos--,pos<2&&(pos=9);if(resultado=soma%11<2?0:11-soma%11,resultado!=digitos.charAt(0))return!1;for(tamanho+=1,numeros=e.substring(0,tamanho),soma=0,pos=tamanho-7,i=tamanho;i>=1;i--)soma+=numeros.charAt(tamanho-i)*pos--,pos<2&&(pos=9);return resultado=soma%11<2?0:11-soma%11,resultado==digitos.charAt(1)}function U(e){var o="",t="";$("#osc_parceira").find("input").autocomplete({source:function(i,n){var s=$(this)[0].term;G(s)&&$.ajax({url:a,type:"GET",dataType:"json",data:{flag:"autocomplete",rota:r.AutocompleteOSCByCnpj(B(s).replace(/ /g,"+"),10)},success:function(a){null==a?$("#osc_parceira").find("input")[e].value="Entidade não cadastrada! ":(o=a[0].tx_nome_osc,t=a[0].id_osc,$("#osc_parceira").find("input")[e].value=o,$("#osc_parceira").find("input")[e].id_osc_parceira=t)},error:function(e){n([])}})}})}function N(){function e(e){var a={};return e.each(function(){var e=$(this).closest(".form-group"),o=$(this).val();if("-1"===o&&(o=""),void 0===e.attr("id")&&(e=$(this).parent()),$(this).closest(".metas").length>0){if(e=$(this).closest(".metas")[0],void 0===a.objetivo_meta&&(a.objetivo_meta=[]),$(this).prop("checked")){var t=o.split(" ")[0];a.objetivo_meta.push({cd_meta_projeto:t,tx_meta_projeto:o})}}else if("fonte_recursos"===e.attr("id"))void 0===a[e.attr("id")]&&(a[e.attr("id")]=[]),"fonte_recursos"===$(this).parent().parent().attr("id")&&("Recursos públicos"===o&&(o=1),"Recursos privados"===o&&(o=2),"Recursos próprios"===o&&(o=3),"Outros"===o&&(o=4),""===o?a[e.attr("id")]=null:a[e.attr("id")].push({cd_origem_fonte_recursos_projeto:o}));else if("area_atuacao_outra"===e.attr("id"))Array.isArray(a[e.attr("id")])?a[e.attr("id")].push({cd_area_atuacao_projeto:$(this).attr("id")?$(this).attr("id"):null,tx_area_atuacao_projeto:o}):(a[e.attr("id")]=[],a[e.attr("id")].push({cd_area_atuacao_projeto:$(this).attr("id")?$(this).attr("id"):null,tx_area_atuacao_projeto:o}));else if("objetivos"===e.attr("id"));else if("tx_nome_status_projeto"===e.attr("id")){var i=null;"Planejado"===o&&(i=1),"Em Execução"===o&&(i=2),"Finalizado"===o&&(i=3),a.cd_status_projeto=i}else if("tx_nome_abrangencia_projeto"===e.attr("id")){var r=null;"Municipal"===o&&(r=1),"Estadual"===o&&(r=2),"Regional"===o&&(r=3),"Nacional"===o&&(r=4),a.cd_abrangencia_projeto=r}else if("tx_nome_zona_atuacao"===e.attr("id")){var n=null;"Urbana"===o&&(n=1),"Rural"===o&&(n=2),a.cd_zona_atuacao_projeto=n}else if("localizacao_projeto"===e.attr("id")){var s=[],c={};(h=e.find("input")).each(function(){""!==$(this).val()&&((c={}).tx_nome_regiao_localizacao_projeto=$(this).val(),s.push(c))}),a.localizacao=s.length>0?s:null}else if("publico_beneficiado"===e.attr("id")){publicos_beneficiados=[];var l={};(h=e.find("input")).each(function(){""!==$(this).val()&&((l={}).tx_nome_publico_beneficiado=$(this).val(),publicos_beneficiados.push(l))}),a.publico_beneficiado=publicos_beneficiados.length>0?publicos_beneficiados:null}else if("financiador_projeto"===e.attr("id")){var d=[],u={};(h=e.find("input")).each(function(){""!==$(this).val()&&((u={}).tx_nome_financiador=$(this).val(),d.push(u))}),a.financiador_projeto=d.length>0?d:null}else if("osc_parceira"===e.attr("id")){var p=[],_={},h=e.find("input");h.each(function(){""!==$(this).val()&&((_={}).id_osc=$(this)[0].id_osc_parceira?$(this)[0].id_osc_parceira:null,p.push(_))}),a.osc_parceira=null==p?null:p.length>0?p:null}else a[e.attr("id")]=o}),a}var a={},o=0;$(".projeto").each(function(){if(!$(this).hasClass("projeto-salvo")){var i=$(this).attr("id"),n=(i.substr(0,i.indexOf("-")),i.substr(i.indexOf("-")+1)),s=$($(this).find("div")[0]).attr("id");o=Number(n),s=s||null,a=$.extend({},a,e($(this).find("input"))),a=$.extend({},a,e($(this).find("textarea"))),void 0===(a=$.extend({},a,e($(this).find("select")))).objetivo_meta&&(a.objetivo_meta=null),a.headers=W,a.id_osc=Y,o<0?(a.id_projeto=null,a.tx_identificador_projeto_externo=s,arrayCampos=["localizacao","publico_beneficiado","financiador_projeto","osc_parceira"],arrayCampos.map(function(e){a.hasOwnProperty(e)||(a[e]=null)}),success=t.carregaAjax(r.CriarProjectByID(Y),"POST",a),console.log(success),"Projeto adicionado."===success.msg&&($(this).addClass("hidden"),$(this).addClass("projeto-salvo"),$(this).prev().append(" - "+a.tx_nome_projeto))):(a.id_projeto=o,a.tx_identificador_projeto_externo=s,arrayCampos=["localizacao","publico_beneficiado","financiador_projeto","osc_parceira"],arrayCampos.map(function(e){a.hasOwnProperty(e)||(a[e]=null)}),success=t.carregaAjax(r.AtualizarProjectByID(Y),"POST",a),console.log(success))}})}var V=void 0!==window.location.href.split("#")[1]?window.location.href.split("#/")[1].split("="):null,Y="";null!==V&&(function(e){var a=JSON.parse(window.localStorage.getItem("Osc"));if("undefined"!=a&&null!==a)for(var o=0;o<a.length;o++)if(a[o]==e)return!0;window.location.href="visualizar-osc.html#/"+e}(Y=V[0]),function(e){$(".btnVisualizar").append('<a id="btnVisualizar" type="button" title="Clique para Visualizar"  class="btn btn-info btn-sm"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Visualizar OSC</a>'),$("#btnVisualizar").attr("href","visualizar-osc.html#/"+e)}(Y),function(e){$("#voltaEditar").attr("href","editar-osc.html#/"+e),urlPagAnterior=document.referrer,-1==urlPagAnterior.indexOf("minhas-oscs")?($("#voltaPagAnterior").text("Visualizar"),$("#voltaPagAnterior").attr("href","visualizar-osc.html#/"+e)):($("#voltaPagAnterior").text("Lista de OSCs"),$("#voltaPagAnterior").attr("href","minhas-oscs.html"))}(Y),r.OSCByID_no_project(Y));var W={User:window.localStorage.getItem("User"),Authorization:window.localStorage.getItem("Authorization")},J="";$.ajax({url:a,type:"GET",dataType:"json",data:{flag:"consulta",rota:r.OSCByID_no_project(Y)},error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(a){function i(e){if(e.files&&e.files[0]&&e.files[0].type.match("image.*")&&e.files[0].size<1e6){var a=document.createElement("img"),o=document.createElement("canvas"),t=new FileReader;t.onload=function(e){a.src=e.target.result,a.onload=function(){var e=a.width,t=a.height;e>t?e>300&&(t*=300/e,e=300):t>225&&(e*=225/t,t=225),o.width=e,o.height=t,o.getContext("2d").drawImage(a,0,0,e,t);var i=o.toDataURL("image/png");$("#imagemLogo").attr("src",i)}},t.readAsDataURL(e.files[0])}else $("#errorLabel").removeClass("hide")}n.montarCabecalho(a,t,e,ReactDOM,g),f=a,s.montarDadosGerais(a,t,o,e,ReactDOM,v);var _=t.validateObject(a.dados_gerais.tx_nome_atividade_economica_osc,""),m=t.validateObject(a.dados_gerais.ft_atividade_economica_osc,""),b=c.montarAreasDeAtuacao(a,t,o,r,_,m,e,ReactDOM,v);l.montarDescricao(a,t,o,e,ReactDOM,v),d.montarTitulosCertificacoes(a,t,e,ReactDOM,v,k);var O=u.montarRelacoesGovernanca(a,t,o);u.ativarTrabalhoGovernanca(o,O,e,ReactDOM,j,x,v,y,t);var R=p.iniciarEspacosPartSoc(a,t,o,j,e,ReactDOM,r.Conselho(),r.Conferencia(),r.PeriodicidadeReuniao(),r.Titularidade(),r.FormaParticipacaoConferencia());p.ativarEspacosPart(R,t,e,ReactDOM,x,P,C,y),S(a,t,o,b),h.montarFontedeRecursos(a,t,r,o,e,ReactDOM,j,v),verificarContraste(),q(),$(".date").datepicker({dateFormat:"dd-mm-yy",changeYear:!0}),$(function(){$(".ano").datepicker({changeYear:!0,showButtonPanel:!0,dateFormat:"yy",yearRange:"1900:2017",onClose:function(e,a){var o=$("#ui-datepicker-div .ui-datepicker-year :selected").val();$(this).datepicker("setDate",new Date(o,1))}}),$(".ano").focus(function(){$(".ui-datepicker-calendar").hide(),$(".ui-datepicker-month").hide(),$(".ui-datepicker-prev").hide(),$(".ui-datepicker-next").hide()}),$("#tx_telefone input.form-control").focusout(function(e){var a,o,t;o=(a=e.currentTarget?e.currentTarget:e.srcElement).value.replace(/\D/g,""),(t=$(a)).unmask(),11===o.length?0==o[0]?t.mask("9999 999 9999"):t.mask("(99) 99999-9999"):10===o.length?t.mask("(99) 9999-9999"):9===o.length?t.mask("(99) 999-9999"):8===o.length?t.mask("9999-9999"):7===o.length&&t.mask("999-9999")}),$("#tx_telefone input.form-control").focusin(function(e){var a;a=e.currentTarget?e.currentTarget:e.srcElement,$(a).unmask()})}),A(),$(".custom-file-upload").on("change",function(){$(".alert").addClass("hide"),$("input[type=file]").each(function(e){""!=$("input[type=file]").eq(e).val()&&i(this)})}),$("#btnRemoverLogo").click(function(){$("#imagemLogo").attr("src","img/camera.jpg"),$("input[type=file]").eq(0).val("")}),$("#loading").hide(),$(".conteudo_loading .section").css("visibility","visible")}}),$("#cancelar").click(function(){window.location.href="/visualizar-osc.html#/"+Y}),$("#salvar").click(function(){var e="",i=t.validateObject(f.dados_gerais,{});$("#dados_gerais :input").each(function(){var e=$(this).attr("id"),a=$(this).val();"tx_nome_situacao_imovel_osc"===e?(i.cd_situacao_imovel_osc=null,"Próprio"===a&&(i.cd_situacao_imovel_osc=1),"Alugado"===a&&(i.cd_situacao_imovel_osc=2),"Cedido"===a&&(i.cd_situacao_imovel_osc=3),"Comodato"===a&&(i.cd_situacao_imovel_osc=4)):i[e]=a}),i.headers=W,i.id_osc=Y;var n=$("#imagemLogo").attr("src");i.im_logo="img/camera.jpg"==n||null==n||void 0==n?null:n,e=t.carregaAjax(r.DadosGerais(Y),"POST",i),(i=t.validateObject(f.area_atuacao,{})).headers=W,i.id_osc=Y,i.area_atuacao=[];var s=o.getSuggestions();$("#areas_de_atuacao .autocomplete").each(function(){for(var e=0,a=0;a<s.length;a++)$(this).val().trim().toLowerCase()===s[a].tx_nome_area_atuacao.trim().toLowerCase()&&(e=s[a].cd_area_atuacao);var o=$(this).attr("id").substring(11),t=$("#macro_area_"+o+"_outros").val();obj_area_atuacao={cd_area_atuacao:e.toString(),tx_nome_area_atuacao_outra:"Outros"===$(this).val()?t:null};var r=[];$(this).siblings(".checkboxList").children(":not(.hidden)").each(function(e){$(this).find("input:checked").each(function(){$(this).closest("label").text();var e="Outros"===$(this).closest("label").text();r.push({tx_nome_subarea_atuacao_outra:e?$("#sub_area_"+o+"_outros").val():null,cd_subarea_atuacao:$(this).val()})}),r.length<=0&&(r=null),obj_area_atuacao.subarea_atuacao=r,i.area_atuacao.push(obj_area_atuacao)}),0==i.area_atuacao.length&&i.area_atuacao.push({cd_area_atuacao:0,tx_nome_area_atuacao_outra:null,subarea_atuacao:null})}),e=t.carregaAjax(r.AtualizarAreaAtuacao(Y),"POST",i),console.log(e);i=t.validateObject(f.descricao,{});$("#descricao .form-control").each(function(){i[$(this).attr("id")]=$(this).val()}),i.headers=W,i.id_osc=Y,e=t.carregaAjax(r.Descricao(Y),"POST",i),console.log(e),(i=t.validateObject(f.certificado,{})).certificado=[],$("#tabela_titulos_certificados tbody tr").each(function(e){var a=0;$(".tipo_titulo_certificado",this).text();switch($(".tipo_titulo_certificado",this).text()){case"Utilidade Pública Estadual":a=7;break;case"Utilidade Pública Municipal":a=8;break;case"Utilidade Pública Federal":a=5;break;case"Entidade Ambientalista":a=1;break;case"CEBAS - Educação":a=2;break;case"CEBAS - Saúde":a=3;break;case"OSCIP":a=4;break;case"CEBAS - Assistência Social":a=6}var o={},t=$(".tipo_titulo_certificado span",this).attr("title");o.bo_oficial="Representante"!=t,o.dt_inicio_certificado="Não informado"!=$(".data_inicio_validade_titulo_certificado",this).text()?$(".data_inicio_validade_titulo_certificado",this).text():"",o.dt_fim_certificado=$(".data_fim_validade_titulo_certificado",this).text(),o.ft_certificado=t,o.ft_inicio_certificado=t,o.ft_fim_certificado=t,o.cd_certificado=a,o.id_certificado=$(this).prop("id"),a>0&&i.certificado.push(o)}),i.headers=W,i.id_osc=Y,0==i.certificado.length&&(i.certificado=null),e=t.carregaAjax(r.Certificado(Y),"POST",i),console.log(e),(i={}).headers=W,i.id_osc=Y,i.governanca=[];var c={};$("#dirigentes").find("input").each(function(e){$(this)[0].value&&(e%2==0?(c.id_dirigente=$(this).attr("id")?$(this).attr("id"):null,c.tx_nome_dirigente=$(this)[0].value,c.ft_nome_dirigente="Representante"):(c.tx_cargo_dirigente=$(this)[0].value,c.ft_cargo_dirigente="Representante",i.governanca.push(c),c={}))}),0==i.governanca.length&&(i.governanca=null),e=t.carregaAjax(r.Dirigente(Y),"POST",i),console.log(e),(i={}).headers=W,i.id_osc=Y,i.conselho_fiscal=[],$("#conselho_fiscal").find("input").each(function(){if($(this)[0].value){var e={};e.id_conselheiro=$(this).attr("id")?$(this).attr("id"):null,e.tx_nome_conselheiro=$(this)[0].value,e.ft_nome_conselheiro="Representante",i.conselho_fiscal.push(e)}}),0==i.conselho_fiscal.length&&(i.conselho_fiscal=null),e=t.carregaAjax(r.ConselhoFiscal(Y),"POST",i),console.log(e),(i={}).headers=W,i.id_osc=Y,i.nr_trabalhadores_voluntarios=$("#voluntarios").val(),e=t.carregaAjax(r.RelacoesTrabalho(Y),"POST",i),console.log(e);var l=[];$.ajax({url:a,type:"GET",async:!1,dataType:"json",data:{flag:"consulta",rota:r.Titularidade()},error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(e){l=e}});var d=[];$.ajax({url:a,type:"GET",async:!1,dataType:"json",data:{flag:"consulta",rota:r.Conselho()},error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(e){d=e}});var u=[];$.ajax({url:a,type:"GET",async:!1,dataType:"json",data:{flag:"consulta",rota:r.PeriodicidadeReuniao()},error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(e){u=e}}),(i={}).headers=W,i.id_osc=Y,i.conselho=[],$(".conselho").each(function(){var e={};e.conselho={},e.representante=[];var a=0,o=0;$(this).find("select").each(function(){$(this).attr("id").split("-");for(t=0;t<d.length;t++)if($(this).val()===d[t].tx_nome_conselho){e.conselho.cd_conselho=d[t].cd_conselho,o=e.conselho.cd_conselho,a=parseInt($(this).attr("id").split("-")[1]),104!=o&&(e.conselho.tx_nome_conselho=null);break}for(t=0;t<l.length;t++)if($(this).val()===l[t].tx_nome_tipo_participacao){e.conselho.cd_tipo_participacao=l[t].cd_tipo_participacao;break}for(var t=0;t<u.length;t++)if($(this).val()===u[t].tx_nome_periodicidade_reuniao_conselho){e.conselho.cd_periodicidade_reuniao_conselho=u[t].cd_periodicidade_reuniao_conselho;break}}),e.conselho.id_conselho=0==a?null:a,$(this).find("select").each(function(a){"outro"==$(this).attr("id").split("-")[0]&&(e.conselho.tx_nome_conselho=$(this).val());for(o=0;o<d.length;o++)if($(this).val()==d[o].tx_nome_conselho){e.conselho.cd_conselho=d[o].cd_conselho;break}for(o=0;o<l.length;o++)if($(this).val()===l[o].tx_nome_tipo_participacao){e.conselho.cd_tipo_participacao=l[o].cd_tipo_participacao;break}for(var o=0;o<u.length;o++)if($(this).val()===u[o].tx_nome_periodicidade_reuniao_conselho){e.conselho.cd_periodicidade_reuniao_conselho=u[o].cd_periodicidade_reuniao_conselho;break}}),$(this).find("input").each(function(a){var t=$(this).attr("id").split("-")[0];0!==o&&("outro"==t&&""!=$(this).val()&&(e.conselho.tx_nome_conselho=$(this).val()),"tx_nome_representante_conselho"===t&&""!=$(this).val()?e.representante.push({tx_nome_representante_conselho:$(this).val()}):"tx_nome_conselho"!==t&&"tx_nome_tipo_participacao"!==t&&(e.conselho[t]=$(this).val()))}),0!==e.representante.length&&null!==t.validateObject(e.conselho.cd_conselho,null)&&i.conselho.push(e)}),0===Object.keys(i.conselho).length&&(i.conselho=null),e=t.carregaAjax(r.ParticipacaoSocialConselho(Y),"POST",i),console.log(e);var p=["Membro de comissão organizadora nacional","Membro de comissão organizadora estadual ou distrital","Membro de comissão organizadora municipal","Delegado para etapa nacional","Delegado para etapa estadual ou distrital","Participante de etapa municipal","Participante de conferência livre ou virtual","Palestrante ou convidado","Observador","Mediador, moderador ou relator","Outro"],_=[1,2,3,4,5,6,7,8,9,10,11],h={};$.ajax({url:a,type:"GET",async:!1,dataType:"json",data:{flag:"consulta",rota:r.Conferencia()},error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(e){h=e}}),(i={}).headers=W,i.id_osc=Y,i.conferencia=[],$(".conferencia").each(function(){var e={},a=0;$(this).find("select").each(function(){$(this).attr("id").split("-")[0];for(o=0;o<h.length;o++)if($(this).val()===h[o].tx_nome_conferencia){e.cd_conferencia=h[o].cd_conferencia,a=parseInt($(this).attr("id").split("-")[1]),e.tx_nome_conferencia="";break}for(var o=0;o<p.length;o++)if($(this).val()===p[o]){e.cd_forma_participacao_conferencia=_[o];break}}),$(this).find("input").each(function(){"outro"==$(this).attr("id").split("-")[0]&&(e.tx_nome_conferencia=$(this).val());for(a=0;a<h.length;a++)if($(this).val()===h[a].tx_nome_conferencia){e.cd_conferencia=h[a].cd_conferencia;break}for(var a=0;a<p.length;a++)if($(this).val()===p[a]){e.cd_forma_participacao_conferencia=_[a];break}(t.contains("19",$(this).val())||t.contains("20",$(this).val()))&&(e.dt_ano_realizacao=$(this).val())}),$.isEmptyObject(e)||(e.id_conferencia=0!=a?a:null,i.conferencia.push(e))}),e=t.carregaAjax(r.ParticipacaoSocialConferencia(Y),"POST",i),console.log(e),(i={}).headers=W,i.id_osc=Y,i.outra=[],$("#outros_part").find("div").children(".form-group").each(function(){$(this).find("input").each(function(){var e=$(this).attr("id").split("-")[0];if(""!==$(this).val()){var a={};a[e]=$(this).val(),i.outra.push(a)}else i.outra.push(null)})}),e=t.carregaAjax(r.OutraParticipacaoSocial(Y),"POST",i),console.log(e),N(),(i={}).headers=W,i.id_osc=Y,i.fonte_recursos=[],$("#recursos").children().each(function(){var e=$(this).find("select").val();$(this).find("input").each(function(){var a={};a.dt_ano_recursos_osc=e,a.cd_fonte_recursos_osc=$(this).attr("id"),a.nr_valor_recursos_osc=$(this).val(),i.fonte_recursos.push(a)})}),e=t.carregaAjax(r.AtualizarFontesRecursos(Y),"POST",i),console.log(e),jsonSalvoSucesso={"Salvo com sucesso!":"Suas alterações serão processadas aproximadamente em 1(uma) hora.<br><br>Obrigado!"},t.abrirModalAjuda("Salvo com sucesso!",jsonSalvoSucesso)})})});