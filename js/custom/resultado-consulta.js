"use strict";function getParameter(a,e){e||(e=location.href);var o="[\\?&]"+(a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"))+"=([^&#]*)",t=new RegExp(o).exec(e);return null==t?null:t[1]}require(["jquery-ui"],function(a){$(document).tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,e){$(this).css(a),$("<div>").addClass("arrow").addClass(e.vertical).addClass(e.horizontal).appendTo(this)}}})});var urlRota,type_http;require(["rotas","jquery-ui","datatables-responsive","leafletCluster","simplePagination","util"],function(a){function e(a){return a=a.replace(/[ÀÁÂÃÄÅ]/g,"A"),a=a.replace(/[àáâãäå]/g,"a"),a=a.replace(/[ÉÈÊË]/g,"E"),a=a.replace(/[éèêë]/g,"e"),a=a.replace(/[ÍÌÎÏ]/g,"I"),a=a.replace(/[íìîï]/g,"i"),a=a.replace(/[ÓÒÔÕ]/g,"O"),a=a.replace(/[óòôõ]/g,"o"),a=a.replace(/[ÚÙÛÜ]/g,"U"),a=a.replace(/[úùûü]/g,"u"),a=a.replace(/[Ç]/g,"C"),a=a.replace(/[ç]/g,"c")}function o(a,e){var o;$("#loading").removeClass("hide"),$("#resultadoconsulta_formato_dados").hide(),e?(type_http="POST",o=M):(type_http="GET",o=null),$.ajax({url:a,type:type_http,dataType:"json",data:o,error:function(a){console.log("Erro no ajax: "+a)},success:function(a){if("Nenhuma Organização encontrada!"!==a){var e=a.length,o=new Array(e),t=0,n="Dado não informado.";for(var r in a)if("0"!=r){o[t]=new Array(6);var i=null!==a[r][4]?a[r][4]:"img/camera.jpg";o[t][0]='<img class="img-circle media-object" src='+i+' height="64" width="64">',o[t][1]=null!==a[r][0]?a[r][0]:n,o[t][2]=null!==a[r][1]?a[r][1]:n,o[t][3]=null!==a[r][2]?a[r][2]:n,o[t][4]=null!==a[r][3]?a[r][3]:n,o[t][5]='<button type="button" onclick="location.href=\'visualizar-osc.html#'+r+'\';" class="btn btn-info"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Detalhar</button>',t++}if(void 0!==o[0]){var l=$("#resultadoconsulta_formato_dados").DataTable({responsive:!0,processing:!0,deferLoading:1e3,deferRender:!0,searching:!1,data:o,dom:"Bfrtip",bPaginate:!1,bSort:!0,aaSorting:[[1,"asc"]],columns:[{title:"",width:50},{title:"Nome da OSC",width:200},{title:"CNPJ"},{title:"Natureza Jurídica"},{title:"Endereço"},{title:"Detalhar"}],aoColumnDefs:[{bSortable:!1,aTargets:[0]},{bSortable:!1,aTargets:[5]},{bSortable:!1,aTargets:[4]}],autoWidth:!0});l.destroy(),l.draw(),$("#resultadoconsulta_formato_dados").show(),$("#loading").addClass("hide")}else $("#modalMensagem").modal({backdrop:"static",keyboard:!1}),$("#modalTitle").text("Nenhuma OSC encontrada!"),"avancado"!==J&&"municipio"!==J?$("#modalConteudo").text('Sua pesquisa "'+decodeURIComponent(U)+'" não retornou nenhuma OSC.'):$("#modalConteudo").text("Sua pesquisa não retornou nenhuma OSC."),$("#modalMensagem").modal("show")}else $("#modalMensagem").modal({backdrop:"static",keyboard:!1}),$("#modalTitle").text("Nenhuma OSC encontrada!"),"avancado"!==J&&"municipio"!==J?$("#modalConteudo").text('Sua pesquisa "'+decodeURIComponent(U)+'" não retornou nenhuma OSC.'):$("#modalConteudo").text("Sua pesquisa não retornou nenhuma OSC."),$("#modalMensagem").modal("show")}}),$("#resultadoconsulta_formato_dados").on("draw.dt",function(){verificarContraste()})}function t(a){for(var e in a)if("0"!=e){var o=function(a,e,o){if(""!==e&&null!==e||null!==o&&""!==o){var t=new PruneCluster.Marker(e,o);return t.data.ID=a,P.PrepareLeafletMarker=function(a,e){a.on("click",function(){!function(a,e){e.bindPopup('<img id="loading" src="img/loading.gif" style="padding-top: 10px; padding-left: 10px;"/>').openPopup(),$.ajax({url:G.OSCPopUpByID(a),type:"GET",dataType:"json",error:function(a){console.log("ERRO no AJAX :"+a)},success:function(o){if(void 0!==o){var t=(null!==o.tx_endereco?o.tx_endereco:"")+" - "+(null!==o.tx_bairro?o.tx_bairro:""),n='<div class="mapa_organizacao clearfix"><span id="spantitle" class="magneticTooltip"><button id="title" class="btn-link"  onclick=location.href="visualizar-osc.html#'+a+'"><h4>'+(null!==o.tx_nome_osc?o.tx_nome_osc:"Dado não informado.")+'</h4></button></span><div class="coluna1"><strong></strong><strong>Endereço: </strong>'+t+"<br><strong>Atividade Econômica: </strong>"+(null!==o.tx_nome_atividade_economica?o.tx_nome_atividade_economica:"Dado não informado.")+"<br><strong>Natureza Jurídica: </strong>"+(null!==o.tx_nome_natureza_juridica?o.tx_nome_natureza_juridica:"Dado não informado.")+'<br><br><div align="center"><button type = button class="btn btn-info" onclick=location.href="visualizar-osc.html#'+a+'"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Detalhar</button></div></div></div>';e.bindPopup(n).openPopup()}}})}(e.ID,a)})},P.RegisterMarker(t),P}return null}(e,a[e][0],a[e][1]);null!==o&&z.addLayer(o)}$("#loadingMapModal").hide(),P.ProcessView()}function n(a){var e=a.target;e.setStyle({weight:5,color:"#666",dashArray:"",fillOpacity:.7}),L.Browser.ie||L.Browser.opera||e.bringToFront(),"GO"==e.feature.properties.Name&&e.bringToBack(),Z.update(e.feature.properties)}function r(a){u.resetStyle(a.target),Z.update()}function i(a){var e=a.target;z.fitBounds(e.getBounds())}function l(a){return a>6e4?"#800026":a>45e3?"#E31A1C":a>3e4?"#FC4E2A":a>15e3?"#FEB24C":a>1e3?"#FED976":"#FFEDA0"}function s(a,e){var l;"regiao"==e||"todos"==e?l="labelClassRegiao":"estado"==e&&(l="labelClassEstado");for(var u in a){var d=L.divIcon({id:a[u].id_regiao,className:l,html:"<p>"+a[u].nr_quantidade_osc_regiao+"</p>"});f[a[u].id_regiao]=a[u].nr_quantidade_osc_regiao;var p=function(a,e,l,u,d){if(""!==l&&null!==l||null!==u&&""!==u){var p;return"regiao"==d||"todos"==d?p=L.marker([l,u],{icon:a}).on("click",function(a){var e=a.target.options.icon.options.id;$("#loadingMapModal").show(),$.ajax({url:G.ClusterEstadoPorRegiao(e),type:"GET",dataType:"json",error:function(a){console.log("ERRO no AJAX :"+a)},success:function(t){if(o(urlRota,R),void 0!==t.length){for(var n=0,r=0;r<t.length;r++)n+=t[r].nr_quantidade_osc_regiao;c(n)}else c(Object.keys(t).length-1);void 0!==t&&(z.setView([a.target._latlng.lat,a.target._latlng.lng],5),z.removeLayer(a.target),delete y[e],s(t,"estado"))}})}):"estado"==d&&(p=L.marker([l,u],{icon:a}).on("click",function(a){var e=a.target.options.icon.options.id;$("#loadingMapModal").show(),$.ajax({url:G.OSCByStateInMap(e),type:"GET",dataType:"json",error:function(a){console.log("ERRO no AJAX :"+a)},success:function(l){if(o(urlRota,R),void 0!==l.length){for(var s=0,u=0;u<l.length;u++)s+=l[u].nr_quantidade_osc_regiao;c(s)}else c(Object.keys(l).length-1);if(void 0!==l){z.setView([a.target._latlng.lat,a.target._latlng.lng],6),z.removeLayer(a.target);var d=v[e];d.off(),d.on({mouseover:n,mouseout:r,click:i}),t(l)}}})})),p}}(d,a[u].id_regiao,a[u].geo_lat_centroid_regiao,a[u].geo_lng_centroid_regiao,e);b.addLayer(p),"estado"==e?h[a[u].id_regiao]=p:"regiao"!=e&&"todos"!=e||(y[a[u].id_regiao]=p)}S||(b.addTo(z),S=!0),$("#loadingMapModal").hide()}function c(a){$(".pagination").pagination({items:a,itemsOnPage:10,hrefTextPrefix:"#",prevText:"Anterior",nextText:"Próximo",onPageClick:function(a){!function(a){null===a&&(a=0);var e=10*parseInt(a)-10;"avancado"==J?(urlRota=G.ConsultaAvancadaLista(e),R=!0):"municipio"==J?urlRota=G.OSCByCounty(U,e):"estado"==J?urlRota=G.OSCByState(U,e):"regiao"==J?urlRota=G.OSCByRegion(U,e):"todos"==J?urlRota=G.AllOSC(e):"organizacao"==J&&(urlRota=G.OSCByName(getParameter("organizacao"),e,getParameter("tipoBusca")));o(urlRota,R)}(a)}})}var u,d,p,g=new Util,m=[],f={},_={},v={},h={},y={},b=L.layerGroup(),C=L.layerGroup(),x=L.layerGroup(),S=!1,O=!0,R=!1,A=!1,T="",M={},E="",j=18,w={center:new L.LatLng(-16.55555555,-60.55555555),zoom:4,minZoom:4},z=new L.Map("map",w),P=new PruneClusterForLeaflet,k=L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{maxZoom:j,attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a>'}),B=L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYW9zY3MiLCJhIjoiY2owbDJpYWxwMDM3dTMzbzh6dDU2bnpzdyJ9._dh2UCWnAeNeG0ZL5sQ5gA",{id:"mapbox.dark",attribution:'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://mapbox.com">Mapbox</a>'}),D=L.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]});z.addLayer(D),z.addLayer(B),z.addLayer(k);var N=new L.Control.FullScreen;z.addControl(N);var I,J,G=new Rotas,F=void 0!==window.location.href.split("?")[1]?window.location.href.split("?")[1].split("="):null,q=$("#buscarPerfil .tab-content");if(q.find(".btn.btn-primary").on("click",function(){var a=q.find(".tab-pane.fade.active.in"),o=a.attr("id"),t=a.find(".form-control").val();t=e(t.trim()).replace(/ /g,"_").replace(/[\/|\\|\||:|#|@|$|&|!|?|(|)|\[|\]]/g,"").replace(/\./g,",").replace(/\+{2,}/g,"_"),"organizacao"==o&&""!==t?(d="./resultado-consulta.html?"+o+"="+t+"&tipoBusca=0",location.href=d):""!==(t=$(".response").val())?(d="./resultado-consulta.html?"+o+"="+t,location.href=d):$("#errorLabel").removeClass("hide")}),$("#organizacao .form-control").autocomplete({minLength:3,source:function(a,o){E=e(a.term.trim()).replace(/ /g,"_").replace(/[\/|\\|\||:|#|@|$|&|!|?|(|)|\[|\]]/g,"").replace(/\./g,","),$.ajax({url:G.AutocompleteOSCByName(E,10,0),type:"GET",dataType:"json",success:function(a){o($.map(a,function(a){return{label:a.tx_nome_osc,value:a.tx_nome_osc,id:a.id_osc}}))},error:function(a){o([])}})},select:function(a,o){d="./resultado-consulta.html?organizacao="+e(o.item.value.trim()).replace(/ /g,"_").replace(/[\/|\\|\||:|#|@|$|&|!|?|(|)|\[|\]]/g,"").replace(/\./g,",").replace(/\+{2,}/g,"_")+"&tipoBusca=1",location.href=d}}),$("#municipio .form-control").autocomplete({minLength:3,source:function(a,o){$.ajax({url:G.AutocompleteOSCByCounty(e(a.term).replace(/ /g,"_").replace(/[\/|\\|\||:|#|@|$|&|!|?|(|)|\[|\]]/g,"").replace(/\./g,","),25),type:"GET",dataType:"json",success:function(a){o($.map(a,function(a){return{label:a.edmu_nm_municipio+" - "+a.eduf_sg_uf,value:a.edmu_nm_municipio+" - "+a.eduf_sg_uf,id:a.edmu_cd_municipio}}))},error:function(a){o([])}})},select:function(a,e){$(".response").val(e.item.id),d="./resultado-consulta.html?municipio="+e.item.id,location.href=d}}),$("#estado .form-control").autocomplete({minLength:3,source:function(a,o){$.ajax({url:G.AutocompleteOSCByState(e(a.term).replace(/ /g,"_").replace(/[\/|\\|\||:|#|@|$|&|!|?|(|)|\[|\]]/g,"").replace(/\./g,","),10),type:"GET",dataType:"json",success:function(a){o($.map(a,function(a){return{label:a.eduf_nm_uf,value:a.eduf_nm_uf,id:a.eduf_cd_uf}}))},error:function(){o([])}})},select:function(a,e){$(".response").val(e.item.id),d="./resultado-consulta.html?estado="+e.item.id,location.href=d}}),$("#regiao .form-control").autocomplete({minLength:3,source:function(a,o){$.ajax({url:G.AutocompleteOSCByRegion(e(a.term).replace(/ /g,"_").replace(/[\/|\\|\||:|#|@|$|&|!|?|(|)|\[|\]]/g,"").replace(/\./g,","),10),type:"GET",dataType:"json",success:function(a){o($.map(a,function(a){return{label:a.edre_nm_regiao,value:a.edre_nm_regiao,id:a.edre_cd_regiao}}))},error:function(){o([])}})},select:function(a,e){$(".response").val(e.item.id),d="./resultado-consulta.html?regiao="+e.item.id,location.href=d}}),$(".ui-autocomplete-input").keypress(function(a){if(13==a.which)return $(".btn-primary").click(),$(".ui-menu-item").hide(),!1}),null!==F){J=F[0];var U=F[1];if(U=U.replace(/\./g,""),U=U.split("&")[0],"organizacao"==J)urlRota=G.OSCByName(getParameter("organizacao"),0,getParameter("tipoBusca")),I=G.OSCByNameInMap(getParameter("organizacao"),getParameter("tipoBusca")),O=!1,A=!0;else if("municipio"==J)urlRota=G.OSCByCounty(U,0),I=G.OSCByCountyInMap(U),O=!1,A=!0,p=U,T="do município ";else if("estado"==J)urlRota=G.OSCByState(U,0),I=G.ClusterEstadoPorRegiao(U),A=!0,p=U,T="do estado ";else if("regiao"==J)urlRota=G.OSCByRegion(U,0),I=G.ClusterRegiao(U),A=!0,p=U,T="da região ";else if("avancado"==J)if(M.avancado=window.localStorage.getItem("params_busca_avancada"),"{}"==M.avancado)J="todos",I=G.ClusterPais(),urlRota=G.AllOSC(0);else{if(urlRota=G.ConsultaAvancadaLista(0),I=G.ConsultaAvancadaMapa(),O=!1,R=!0,g.contains("IDHM",M.avancado)){var X=g.carregaAjax(G.IDHM(),"GET",null);if(void 0!==X)for(var H in X.value){var W={};W.codigo=X.value[H].TERCODIGO,W.valor=X.value[H].a2010m01d01,m.push(W)}}!function(a){var e=JSON.parse(a),o=e.dadosGerais,t="<b><u>Filtros utilizados:</u></b> ",n=!1;if(o){o.tx_razao_social_osc&&(t+="<b><i>Nome da OSC:</i></b> "+o.tx_razao_social_osc+", "),o.tx_nome_regiao&&(t+="<b><i>Região:</i></b> "+o.tx_nome_regiao+", "),o.tx_nome_fantasia_osc&&(t+="<b><i>Nome Fantasia:</i></b> "+o.tx_nome_fantasia_osc+", "),o.tx_nome_uf&&(t+="<b><i>Estado:</i></b> "+o.tx_nome_uf+", "),o.cd_identificador_osc&&(t+="<b><i>CNPJ:</i></b> "+o.cd_identificador_osc+", "),o.anoFundacaoMIN&&(t+="<b><i>Ano de Fundação de:</i></b> "+o.anoFundacaoMIN+", "),o.anoFundacaoMAX&&(t+="<b><i>Ano de Fundação até:</i></b> "+o.anoFundacaoMAX+", "),o.tx_nome_municipio&&(t+="<b><i>Município:</i></b> "+o.tx_nome_municipio+", ");var r="<b><i>Natureza Jurídica:</i></b> ";o.naturezaJuridica_associacaoPrivada&&(r+="Associação Privada, ",n=!0),o.naturezaJuridica_fundacaoPrivada&&(r+="Fundação Privada, ",n=!0),o.naturezaJuridica_organizacaoReligiosa&&(r+="Organização Religiosa, ",n=!0),o.naturezaJuridica_organizacaoSocial&&(r+="Organização Social, ",n=!0),o.naturezaJuridica_outra&&(r+="Não informado, ",n=!0),n&&(t+=r),o.cd_situacao_imovel_osc,o.cd_objetivo_osc,o.cd_meta_osc}var i=e.atividadeEconomica;i&&(t+="<b><i>Atividade Econômica (CNAE):</i></b> "+i.tx_atividade_economica+", ");var l=e.areasSubareasAtuacao;if(l){var s=[];$.ajax({url:G.AreaAtuacao(),type:"GET",async:!1,dataType:"json",error:function(a){console.log("Erro no ajax: ")},success:function(a){for(var e in l){var o=parseInt(e.split("cd_area_atuacao-")[1]);void 0!=o&&$.each(a,function(a,e){o==e.cd_area_atuacao&&-1===s.indexOf(e.tx_nome_area_atuacao)&&s.push(e.tx_nome_area_atuacao)})}$.ajax({url:G.SubAreaAtuacao(),type:"GET",async:!1,dataType:"json",error:function(a){console.log("Erro no ajax: ")},success:function(a){for(e in l){var o=parseInt(e.split("cd_subarea_atuacao-")[1]);void 0!=o&&$.each(a,function(a,e){o==e.cd_subarea_atuacao&&-1===s.indexOf(e.tx_nome_subarea_atuacao)&&s.push(e.tx_nome_subarea_atuacao)})}s.length>0&&(t+="<b><i>Área e Subárea de Atuação:</i></b> "+s.join(", ")+", ")}})}})}$("#filtros p").html(t)}(M.avancado)}else console.log("ERRO de URL!")}else J="todos",I=G.ClusterPais(),urlRota=G.AllOSC(0);if(A){var Y="Análise "+T;$("#analisePerfil").text(Y),$("#analisePerfil").attr("href","analise-perfil.html?localidade="+p)}var Z=L.control();$("#loadingMapModal").show();var V;R?(type_http="POST",V=M):(type_http="GET",V=null),$.ajax({url:I,type:type_http,dataType:"json",data:V,error:function(a){console.log("ERRO no AJAX :"+a)},success:function(a){if(""!==a&&void 0!==a&&"Nenhuma Organização encontrada!"!==a){o(urlRota,R);var e=0;if(O){if(void 0!==a.length)for(var n=0;n<a.length;n++)e+=a[n].nr_quantidade_osc_regiao;c(e),$("#legenda p").append(e),s(a,J)}else c(e=Object.keys(a).length-1),$("#legenda p").append(e),t(a)}else $("#modalMensagem").modal({backdrop:"static",keyboard:!1}),$("#modalTitle").text("Nenhuma OSC encontrada!"),"avancado"!==J&&"municipio"!==J?$("#modalConteudo").text('Sua pesquisa "'+decodeURIComponent(U)+'" não retornou nenhuma OSC.'):$("#modalConteudo").text("Sua pesquisa não retornou nenhuma OSC."),$("#modalMensagem").modal("show")}}),$.ajax({url:G.ClusterEstado(),type:"GET",dataType:"json",error:function(a){console.log("ERRO no AJAX :"+a)},success:function(a){if(void 0!==a){var e={},d={};for(var p in a)e[a[p].tx_sigla_regiao]=a[p].nr_quantidade_osc_regiao,d[a[p].tx_sigla_regiao]=a[p].id_regiao;z.addControl(new L.Control.Layers({"Satélite":D,Contraste:B,Mapa:k},{"Mapa de calor":C,IDHM:x},{collapsed:!1})),function(a,e){var d;$.each(statesData.features,function(o){d=statesData.features[o].properties.Name,statesData.features[o].properties.density=a[d],statesData.features[o].properties.id=e[d]}),z.addLayer(C),z.addLayer(x),Z.onAdd=function(a){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},Z.update=function(a){this._div.innerHTML="<h4>OSCs por Estado</h4>"+(a?"<b>"+a.Name+"</b><br />"+a.density+" OSCs.":"Passe o mouse sobre um estado")},Z.addTo(z);var p=L.control({position:"bottomright"});p.onAdd=function(a){var e=L.DomUtil.create("div","info legend"),o=[0,1e3,15e3,3e4,45e3,6e4];e.innerHTML+="<h5>Escala de OSCs por estado</h5>";for(var t=0;t<o.length;t++)e.innerHTML+='<i style="background:'+l(o[t]+1)+'"></i> '+parseInt(o[t]+1)+(o[t+1]?"&ndash;"+o[t+1]+"<br>":"+");return e},p.addTo(z),u=L.geoJson(statesData,{style:function(a){return{fillColor:l(a.properties.density),weight:2,opacity:1,color:"white",dashArray:"3",fillOpacity:.6}},onEachFeature:function(a,e){e.on({mouseover:n,mouseout:r,click:function(a){var e=a.target;if(z.fitBounds(e.getBounds()),function(a){$("#loadingMapModal").show(),$.ajax({url:G.OSCByStateInMap(a),type:"GET",dataType:"json",error:function(a){console.log("ERRO no AJAX :"+a)},success:function(a){if(o(urlRota,R),void 0!==a.length){for(var e=0,n=0;n<a.length;n++)e+=a[n].nr_quantidade_osc_regiao;c(e)}else c(Object.keys(a).length-1);void 0!==a&&t(a)}})}(e.feature.properties.id),void 0==y[e.feature.properties.Regiao]){var l=h[e.feature.properties.id];void 0!=l&&z.removeLayer(l)}else!function(a){var e=a.feature.properties.Regiao;$("#loadingMapModal").show(),$.ajax({url:G.ClusterEstadoPorRegiao(e),type:"GET",dataType:"json",error:function(a){console.log("ERRO no AJAX :"+a)},success:function(t){if(o(urlRota,R),void 0!==t.length){for(var n=0,r=0;r<t.length;r++)n+=t[r].nr_quantidade_osc_regiao;c(n)}else c(Object.keys(t).length-1);if(void 0!==t){s(t,"estado");var i=y[e];z.removeLayer(i),delete y[e];var l=h[a.feature.properties.id];z.removeLayer(l)}}})}(e);e.off(),e.on({mouseover:n,mouseout:r,click:i})}}),C.addLayer(e),x.addLayer(e),v[e.feature.properties.id]=e,_[e.feature.properties.id]=e}}).addTo(z)}(e,d)}}}),z.on("zoomend",function(a){z.getZoom()==j&&(z.removeLayer(C),z.removeLayer(x))})});